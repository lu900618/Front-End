# React

## React ä¸­çš„æ ¸å¿ƒæ¦‚å¿µ

### è™šæ‹Ÿ DOM

- DOM çš„æœ¬è´¨ï¼š js è¡¨ç¤ºçš„ UI å…ƒç´ 

- DOM å’Œ è™šæ‹ŸDOM

  - DOM æµè§ˆå™¨æä¾›çš„åŠŸèƒ½ï¼Œåªèƒ½ä½¿ç”¨æµè§ˆå™¨å›ºå®šçš„ API
  - è™šæ‹Ÿ DOM æ˜¯ç¨‹åºå‘˜åˆ›å»ºçš„ï¼Œç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„ DOMï¼Œä½†æ˜¯æœ‰æœ¬è´¨çš„åŒºåˆ«ã€‚

- ä¸ºä»€ä¹ˆè¦å®ç°è™šæ‹Ÿ DOMï¼Ÿ

  é¡µé¢ä¸­çš„æ•°æ®ï¼Œå“ªæ€•å‘ç”Ÿäº†ä¸€ç‚¹ç‚¹çš„å˜åŒ–ï¼Œéƒ½ä¼šå¼ºåˆ¶é‡å»ºæ•´ä¸ª DOM æ ‘ã€‚

  è¿™ä¼šæ¶‰åŠåˆ°å¾ˆå¤šå…ƒç´ çš„é‡ç»˜å’Œé‡æ’ï¼Œå¯¼è‡´æ€§èƒ½æµªè´¹ä¸¥é‡ã€‚

  è§£å†³åŠæ³•ï¼šæŒ‰éœ€æ›´æ–°é¡µé¢ä¸Šçš„æ•°æ®ï¼ŒæŠŠéœ€è¦ä¿®æ”¹çš„æ•°æ®æ‰€å¯¹åº”çš„ DOM å…ƒç´ é‡æ–°æ„å»ºï¼Œå…¶ä»–æ²¡æœ‰å˜åŒ–çš„æ•°æ®å¯¹åº”çš„ DOM èŠ‚ç‚¹ä¸éœ€è¦è¢«å¼ºåˆ¶æ›´æ–°ã€‚

  - è™šæ‹Ÿ DOM çš„æœ¬è´¨ï¼šç”¨ js å¯¹è±¡æ¥æ¨¡æ‹Ÿ DOM æ ‘
  - è™šæ‹Ÿ DOM çš„ç›®çš„ï¼šä¸ºäº†å®ç° DOM èŠ‚ç‚¹çš„é«˜æ•ˆæ›´æ–°

### DIFF ç®—æ³•

- tree diff - æ–°æ—§ DOM æ ‘ï¼Œé€å±‚å¯¹æ¯”çš„æ–¹å¼ã€‚

- component diff - åœ¨å¯¹æ¯”æ¯ä¸€å±‚çš„æ—¶å€™ï¼Œè¿™äº›ç»„ä»¶ä¹‹é—´çš„å¯¹æ¯”ï¼šå¦‚æœä¸¤ä¸ªç»„ä»¶çš„**ç±»å‹**ç›¸åŒï¼Œåˆ™æš‚æ—¶è®¤ä¸ºè¿™ä¸ªç»„ä»¶ä¸éœ€è¦è¢«æ›´æ–°ï¼›å¦‚æœç»„ä»¶çš„ç±»å‹ä¸åŒï¼Œåˆ™ç«‹å³å°†æ—§çš„ç»„ä»¶ç§»é™¤ï¼Œæ–°å»ºä¸€ä¸ªç»„ä»¶ï¼Œæ›¿æ¢åˆ°è¢«ç§»é™¤çš„ä½ç½®ã€‚

- element diff - åœ¨ç»„ä»¶ä¸­ï¼Œæ¯ä¸ªå…ƒç´ ä¹‹é—´ä¹Ÿè¦å¯¹æ¯”ã€‚å…ƒç´ çº§åˆ«çš„å¯¹æ¯”ï¼Œå°±æ˜¯ element diffã€‚

- key - è¿™ä¸ªå±æ€§ï¼Œå¯ä»¥æŠŠ DOM èŠ‚ç‚¹å’Œè™šæ‹Ÿ DOM ä¸­çš„å¯¹è±¡ï¼Œåšä¸€å±‚å…³è”å…³ç³»ã€‚

## Reactçš„ä½¿ç”¨

### ç¯å¢ƒé…ç½®

1.ä¸‹è½½

```bash
npm install react react-dom -S
npm install babel-preset-react -D
```

2.é…ç½® webpack

```js
// æ·»åŠ jsxè§£æ
{ test: /\.jsx?$/, use: 'babel-loader', exclude: /node_modules/ }
```

```js
// å®Œæ•´ webpack.config.js
var path = require('path')
var webpack = require('webpack')
var HtmlWebpackPlugin = require('html-webpack-plugin');
var ExtractTextPlugin = require('extract-text-webpack-plugin');
var OpenBrowserPlugin = require('open-browser-webpack-plugin');

// var nodeModulesPath = path.resolve(__dirname, 'node_modules')
// console.log(process.env.NODE_ENV)

module.exports = {
    entry: path.resolve(__dirname, 'app/index.jsx'),
    output: {
        path: __dirname + "/build",
        filename: "bundle.js"
    },

    resolve:{
        extensions:['', '.js','.jsx']
    },

    module: {
        // preLoaders: [
        //     // æŠ¥é”™ ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ
        //     {test: /\.(js|jsx)$/, loader: "eslint-loader", exclude: /node_modules/}
        // ],
        loaders: [
            { test: /\.(js|jsx)$/, exclude: /node_modules/, loader: 'babel' },
            { test: /\.scss$/, exclude: /node_modules/, loader: 'style!css!postcss!sass' },
            { test: /\.css$/, exclude: /node_modules/, loader: 'style!css!postcss' },
            { test:/\.(png|gif|jpg|jpeg|bmp)$/i, loader:'url-loader?limit=10000' },  // é™åˆ¶å¤§å°10kb
            { test:/\.(png|woff|woff2|svg|ttf|eot)($|\?)/i, loader:'url-loader?limit=10000'} // é™åˆ¶å¤§å°å°äº10k
        ]
    },

    eslint: {
        configFile: '.eslintrc' // Rules for eslint
    },

    postcss: [
        require('autoprefixer') //è°ƒç”¨autoprefixeræ’ä»¶ï¼Œä¾‹å¦‚ display: flex
    ],

    plugins: [
        // html æ¨¡æ¿æ’ä»¶
        new HtmlWebpackPlugin({
            template: __dirname + '/app/index.tmpl.html'
        }),

        // çƒ­åŠ è½½æ’ä»¶
        new webpack.HotModuleReplacementPlugin(),

        // æ‰“å¼€æµè§ˆå™¨
        new OpenBrowserPlugin({
          url: 'http://localhost:8888'
        }),

        // å¯åœ¨ä¸šåŠ¡ js ä»£ç ä¸­ä½¿ç”¨ __DEV__ åˆ¤æ–­æ˜¯å¦æ˜¯devæ¨¡å¼ï¼ˆdevæ¨¡å¼ä¸‹å¯ä»¥æç¤ºé”™è¯¯ã€æµ‹è¯•æŠ¥å‘Šç­‰, productionæ¨¡å¼ä¸æç¤ºï¼‰
        new webpack.DefinePlugin({
          __DEV__: JSON.stringify(JSON.parse((process.env.NODE_ENV == 'dev') || 'false'))
        })
    ],

    devServer: {
        /*proxy: {
          // å‡¡æ˜¯ `/api` å¼€å¤´çš„ http è¯·æ±‚ï¼Œéƒ½ä¼šè¢«ä»£ç†åˆ° localhost:3000 ä¸Šï¼Œç”± koa æä¾› mock æ•°æ®ã€‚
          // koa ä»£ç åœ¨ ./mock ç›®å½•ä¸­ï¼Œå¯åŠ¨å‘½ä»¤ä¸º npm run mock
          '/api': {
            target: 'http://localhost:3000',
            secure: false
          }
        },*/
        port: 8888,
        contentBase: "./public", //æœ¬åœ°æœåŠ¡å™¨æ‰€åŠ è½½çš„é¡µé¢æ‰€åœ¨çš„ç›®å½•
        colors: true, //ç»ˆç«¯ä¸­è¾“å‡ºç»“æœä¸ºå½©è‰²
        historyApiFallback: true, //ä¸è·³è½¬
        inline: true, //å®æ—¶åˆ·æ–°
        hot: true  // ä½¿ç”¨çƒ­åŠ è½½æ’ä»¶ HotModuleReplacementPlugin
    }
}
```

```js
// å®Œæ•´ webpack.production.config.js
var path = require('path')
var webpack = require('webpack');
var HtmlWebpackPlugin = require('html-webpack-plugin');
var ExtractTextPlugin = require('extract-text-webpack-plugin');

module.exports = {
  entry: {
    app: path.resolve(__dirname, 'app/index.jsx'),
    // å°† ç¬¬ä¸‰æ–¹ä¾èµ– å•ç‹¬æ‰“åŒ…
    vendor: [
      'react',
      'react-dom',
      'react-redux',
      'react-router',
      'redux',
      'es6-promise',
      'whatwg-fetch',
      'immutable'
    ]
  },
  output: {
    path: __dirname + "/build",
    filename: "[name].[chunkhash:8].js",
    publicPath: '/'
  },

  resolve:{
      extensions:['', '.js','.jsx']
  },

  module: {
    loaders: [
        { test: /\.(js|jsx)$/, exclude: /node_modules/, loader: 'babel' },
        { test: /\.less$/, exclude: /node_modules/, loader: ExtractTextPlugin.extract('style', 'css!postcss!less') },
        { test: /\.css$/, exclude: /node_modules/, loader: ExtractTextPlugin.extract('style', 'css!postcss') },
        { test:/\.(png|gif|jpg|jpeg|bmp)$/i, loader:'url-loader?limit=5000&name=img/[name].[chunkhash:8].[ext]' },
        { test:/\.(png|woff|woff2|svg|ttf|eot)($|\?)/i, loader:'url-loader?limit=5000&name=fonts/[name].[chunkhash:8].[ext]'}
    ]
  },
  postcss: [
    require('autoprefixer')
  ],

  plugins: [
    // webpack å†…ç½®çš„ banner-plugin
    new webpack.BannerPlugin("Copyright by wangfupeng1988@github.com."),

    // html æ¨¡æ¿æ’ä»¶
    new HtmlWebpackPlugin({
        template: __dirname + '/app/index.tmpl.html'
    }),

    // å®šä¹‰ä¸ºç”Ÿäº§ç¯å¢ƒï¼Œç¼–è¯‘ React æ—¶å‹ç¼©åˆ°æœ€å°
    new webpack.DefinePlugin({
      'process.env':{
        'NODE_ENV': JSON.stringify(process.env.NODE_ENV)
      }
    }),

    // ä¸ºç»„ä»¶åˆ†é…IDï¼Œé€šè¿‡è¿™ä¸ªæ’ä»¶webpackå¯ä»¥åˆ†æå’Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨æœ€å¤šçš„æ¨¡å—ï¼Œå¹¶ä¸ºå®ƒä»¬åˆ†é…æœ€å°çš„ID
    new webpack.optimize.OccurenceOrderPlugin(),

    new webpack.optimize.UglifyJsPlugin({
        compress: {
          //supresses warnings, usually from module minification
          warnings: false
        }
    }),

    // åˆ†ç¦»CSSå’ŒJSæ–‡ä»¶
    new ExtractTextPlugin('[name].[chunkhash:8].css'),

    // æä¾›å…¬å…±ä»£ç 
    new webpack.optimize.CommonsChunkPlugin({
      name: 'vendor',
      filename: '[name].[chunkhash:8].js'
    }),

    // å¯åœ¨ä¸šåŠ¡ js ä»£ç ä¸­ä½¿ç”¨ __DEV__ åˆ¤æ–­æ˜¯å¦æ˜¯devæ¨¡å¼ï¼ˆdevæ¨¡å¼ä¸‹å¯ä»¥æç¤ºé”™è¯¯ã€æµ‹è¯•æŠ¥å‘Šç­‰, productionæ¨¡å¼ä¸æç¤ºï¼‰
    new webpack.DefinePlugin({
      __DEV__: JSON.stringify(JSON.parse((process.env.NODE_ENV == 'dev') || 'false'))
    })
  ]
}
```

3.é…ç½® .babelrc æ–‡ä»¶

```babelrc
{
  "presets": ["env", "stage-0", "react"],
  "plugins": ["transform-runtime"]
}
```

4.ä½¿ç”¨è„šæ‰‹æ¶

```bash
npm install -g create-react-app
create-react-app my-app

cd my-app
npm start
```

å¦‚æœ npm ç‰ˆæœ¬é«˜äº 5.2.0ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
px create-react-app my-app

cd my-app
npm start
```

### ReactDOM.render()

React æ˜¯å›´ç»•å¯é‡ç”¨ç»„ä»¶çš„æ¦‚å¿µè®¾è®¡çš„ã€‚æ‰€æœ‰çš„å°ç»„ä»¶éƒ½å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œç”šè‡³è·¨ä¸åŒçš„é¡¹ç›®ã€‚

ä¸€ä¸ªReactç»„ä»¶(æœ€ç®€å•çš„å½¢å¼)æ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå‡½æ•°

```js
function Button (props) {
  return (
    <button type="submit">{props.label}</button>
  )
}
ReactDOM.render(<Button label="Save" />, mountNode)
```

`ReactDOM.render('ç¬¦åˆxmlè§„èŒƒçš„HTMLè¯­æ³•', æ’å…¥æŒ‡å®šçš„DOM)`

```html
<!-- index.html -->
<body>
  <!-- è¿™æ˜¯å®¹å™¨Divï¼Œå°†æ¥ä½¿ç”¨Reactæ¸²æŸ“çš„è™šæ‹ŸDOMï¼Œéƒ½ä¼šæ”¾åˆ°è¿™ä¸ªä½ç½® -->
  <div id="app"></div>
</body>
```

```jsx
import React from 'react'
import ReactDOM from 'react-dom'

ReactDOM.render(
  <h1 id="mydiv" title="è¿™æ˜¯ä¸€ä¸ªDIV">è¿™æ˜¯ä¸€ä¸ªDIV</h1>,
  document.getElementById('app')
)
```

- ç»„ä»¶åä»¥**å¤§å†™å­—æ¯å¼€å¤´**ã€‚å°å†™çš„åç§°ä¿ç•™ç»™HTMLå…ƒç´ ã€‚äº‹å®ä¸Šï¼Œå°†ç»„ä»¶åå°å†™å‘½åï¼ŒReactDOMå°†å¿½ç•¥è¯¥å‡½æ•°å¹¶å‘ˆç°å¸¸è§„ç©ºçš„HTML
- æ¯ä¸€ä¸ªç»„ä»¶éƒ½æ¥æ”¶ä¸€ä¸ªå±æ€§åˆ—è¡¨ï¼Œå°±åƒHTMLå…ƒç´ ä¸€æ ·ã€‚åœ¨ React ä¸­ï¼Œè¿™ä¸ªåˆ—è¡¨å«åš `props`ã€‚

#### jsx

HTML è¯­è¨€ç›´æ¥å†™åœ¨ JavaScript ä¸­ï¼Œä¸åŠ ä»»ä½•å¼•å·å°±æ˜¯ jsx çš„è¯­æ³•ï¼Œjsx å…è®¸å°† HTML ä¸ JavaScript æ··å†™ã€‚

```jsx
var names = ['zs', 'ls', 'ww']

function Hello (props) {
  return <div>
    <h1>{props.name}</h1>
  </div>
}

ReactDOM.render(
  <Hello>{...names}</Hello>,
  document.getElementById('app')
)
```

åœ¨ jsx ä¸­å¾ªç¯éå†

```jsx
class CommentList extends ReactDOM.Component {
  constructor (props) {
    super(props)
    this.state = {
      cmts: [
        {user: 'zs', content: 'test cmt1'},
        {user: 'ls', content: 'test cmt2'},
        {user: 'ww', content: 'test cmt3'},
        {user: 'nl', content: 'test cmt4'}
      ]
    }
  }
  render () {
    return <div>
      {this.state.cmts.map((item, i) => {
        return <div key={i}>
          <p>{item.user}</p>
            <p>{item.content}</p>
        </div>
      })}
    </div>
  }
}

ReactDOM.render(<div>
  <CommentList></CommentList>
</div>, document.getElementById('app'))
```

```jsx
function CommentItem (props) {
  return <div>
    <h1>{props.user}</h1>
    <p>{props.content}</p>
  </div>
}

class CommentList extends ReactDOM.Component {
  constructor (props) {
    super(props)
    this.state = {
      cmts: [
        {user: 'zs', content: 'test cmt1'},
        {user: 'ls', content: 'test cmt2'},
        {user: 'ww', content: 'test cmt3'},
        {user: 'nl', content: 'test cmt4'}
      ]
    }
  }
  render () {
    return <div>
      {this.state.cmts.map((item, i) => {
        // return <CommentItem user="item.user" content="item.content" key={i}></CommentItem>
        return <CommentItem {...item} key={i}></CommentItem>
      })}
    </div>
  }
}

ReactDOM.render(<div>
  <CommentList></CommentList>
</div>, document.getElementById('app'))
```

## ç»„ä»¶

```jsx
// Hello.jsx
import React from 'react'

export default function Hello (props) {
  return <p>{props.name}</p>
}
```

```jsx
// Hi.jsx
import React from 'react'

export default Hi extends React.Component{
  constructor (props) {
    super(props)
    this.state = {
      msg: 'è¿™æ˜¯ Hi ç»„ä»¶çš„ç§æœ‰ msg æ•°æ®'
    }
  }

  render () {
    return <div>
      <h3>è¿™æ˜¯ extends React.Component åˆ›å»ºçš„ç»„ä»¶</h3>
      <h3>è¿™æ˜¯å¤–éƒ¨ä¼ æ¥çš„æ•°æ®ï¼š{this.props.address}</h3>
      <h3>è¿™æ˜¯ Hi ç»„ä»¶çš„ç§æœ‰ msg æ•°æ®: {this.state.msg}</h3>
    </div>
  }
}
```

```jsx
// main.js
import React from 'react'
import ReactDOM from 'react-dom'

import Hello from './components/Hello.jsx'

ReactDOM.render(
  <div>
    <Hello name="zs"></Hello>
    <Hi address="bj"></Hi>
  </div>,
  document.getElementById('app')
)
```

    æ³¨æ„ï¼š
    ä»¥ä¸Šä¸¤ç§åˆ›å»ºç»„ä»¶çš„æ–¹å¼ï¼Œæœ‰æœ¬è´¨çš„åŒºåˆ«ã€‚
    1. ä½¿ç”¨ function æ„é€ å‡½æ•°åˆ›å»ºçš„ç»„ä»¶ï¼Œå†…éƒ¨æ²¡æœ‰ state ç§æœ‰æ•°æ®ï¼Œåªæœ‰ä¸€ä¸ª props æ¥æ¥æ”¶å¤–éƒ¨ä¼ é€’è¿‡æ¥çš„æ•°æ®ã€‚
    2. ä½¿ç”¨ class å…³é”®å­—åˆ›å»ºçš„ç»„ä»¶ï¼Œå†…éƒ¨é™¤äº†æœ‰ this.props è¿™ä¸ªåªè¯»å±æ€§ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºå­˜æ”¾è‡ªå·±ç§æœ‰æ•°æ®çš„ this.state å±æ€§ï¼Œè¿™ä¸ª state æ˜¯å¯è¯»å¯å†™çš„ã€‚

- æ— çŠ¶æ€ç»„ä»¶ï¼šä½¿ç”¨ function åˆ›å»ºçš„ç»„ä»¶ã€‚
  ä¸€ä¸ªç»„ä»¶ï¼Œåªéœ€è¦æ ¹æ®å¤–éƒ¨ä¼ é€’è¿‡æ¥çš„ propsï¼Œæ¸²æŸ“å›ºå®šçš„é¡µé¢ç»“æ„ï¼Œé€‚ç”¨ function åˆ›å»ºçš„æ— çŠ¶æ€ç»„ä»¶ã€‚
- æœ‰çŠ¶æ€ç»„ä»¶ï¼šä½¿ç”¨ class åˆ›å»ºçš„ç»„ä»¶ã€‚
  ä¸€ä¸ªç»„ä»¶ï¼Œéœ€è¦å­˜æ”¾è‡ªå·±çš„ç§æœ‰æ•°æ®ï¼Œæˆ–è€…éœ€è¦åœ¨ç»„ä»¶çš„ä¸åŒé˜¶æ®µæ‰§è¡Œä¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼Œé€‚ç”¨ class åˆ›å»ºçš„æœ‰çŠ¶æ€ç»„ä»¶ã€‚

### æ ·å¼æ¨¡å—åŒ–

1.ä¿®æ”¹ webpack é…ç½®

```js
// ä¿®æ”¹ css-loader
css-loader?modules&localIdentName=[name]_[local]-[hash:8]
```

2.å¯¼å…¥æ ·å¼

```js
import itemStyles from ''
```

## React çš„å£°æ˜å‘¨æœŸ

![](images/React/Reactä¸­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ.png)

## React-router

`react-router` æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œå®‰è£… `npm install react-router --save`

åœ¨æ ¹ç›®å½•ä¸‹æ–°å»º `router` æ–‡ä»¶å¤¹ï¼Œç„¶åæ–°å»ºä¸€ä¸ª `routerMap.jsx` æ–‡ä»¶

```jsx
import React from 'react'
import { Router, Route, IndexRoute } from 'react-router'

import App from '../containers/App'
import Home from '../containers/HomePage/Home'
import List from '../containers/ListPage/List'
import NotFound from '../containers/NotFound/Notfound'

class RouteMap extends React.Component{
    render(){
        return(
            <Router history={this.props.history}>
                <Route path='/' component={App}>
                    <IndexRoute component={Home}/>
                    <Route path='list' component={List}/>
                    <Route path="*" component={NotFound}/>
                </Route>
            </Router>
        )
    }
}
export default RouteMap
```

åœ¨ App.jsx é‡Œå¼•ç”¨ç›¸åº”çš„è·¯ç”±åˆ‡æ¢ç»„ä»¶ `{this.props.children}`

```jsx
import React from 'react'
import Head from '../components/head/head'
import Menu from '../components/Menu/menu'
class App extends React.Component {
  render() {
    return (
      <div>
        <Head/>
        <div className="wrap">
          <div className="menu">
            <Menu/>
          </div>
          <div>{this.props.children}</div>
        </div>
      </div>
    )
  }
}
export default App
```

åœ¨æ ¹ç›®å½•ä¸‹çš„å…¥å£æ–‡ä»¶index.jsxå¼•å…¥routerMap

```jsx
import React from 'react';
import ReactDOM from 'react-dom';

import RouteMap from './router/routerMap'
import {hashHistory} from 'react-router'

import  './static/index.scss'

ReactDOM.render(
  <RouteMap history={hashHistory}/>,
  document.getElementById('root')
);
```

ä½¿ç”¨èœå•é“¾æ¥è¿›è¡Œè·¯ç”±è·³è½¬

```jsx
import React from 'react'
import { Link } from 'react-router'
class Menu extends React.Component{
    render(){
        return(
            <div className="menu">
                <ul>
                    <li>
                        <Link to="/">Home</Link>
                    </li>
                    <li>
                        <Link to="/list" activeClassName="active">List</Link>
                    </li>
                </ul>
            </div>
        )
    }
}
export default Menu
```

## react-redux

### 1. å®šä¹‰è®¡ç®—è§„åˆ™ reducers

åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª reducers æ–‡ä»¶å¤¹ï¼Œä¸‹é¢æ–°å»º index.js ç”¨æ¥å­˜æ”¾æ‰€æœ‰çš„è§„åˆ™ï¼Œæ¯”å¦‚éœ€è¦å®šä¹‰ userinfo éƒ¨åˆ†çš„è¿”å›è§„åˆ™ï¼Œå°±æ–°å»ºä¸€ä¸ª userinfo.jsï¼š

```js
// /reducers/userinfo.js
import * as actionTypes from '../constants/userinfo'

const initialState = {}

export default function userinfo (state = initialState, action) {
  switch (action.type) {
    // login
    case actionTypes.USERINFO_LOGIN:
      return action.data
    // update city
    case actionTypes.UPDATE_CITYNAME:
      return action.data
    default:
      return state
  }
}
```

è¿™é‡Œé€šè¿‡ actionTypesæ¥ç»Ÿä¸€ç®¡ç†è¿™äº›å˜é‡çš„åç§°ï¼Œä¸€æ˜¯ä¸¤ä¸ªåœ°æ–¹ç”¨åˆ°ï¼ŒäºŒæ˜¯ä¸ºäº†ç»Ÿä¸€ç®¡ç†ï¼Œæ‰€ä»¥å•ç‹¬èµ·çš„ä¸€ä¸ªconstantsçš„æ–‡ä»¶ï¼Œç„¶åé‡Œè¾¹æœ‰ä¸€ä¸ªuserinfo.jsçš„æ–‡ä»¶

```js
// /constants/userinfo.js
export const USERINFO_LOGIN = 'USERINFO LOGIN'
export const UPDATE_CITYNAME = 'UPDATE CITYNAME'
```

```js
// /reducers/index.js
import { combineReducers } from 'redux'

import userinfo from './userinfo'

const rootReducer = combineReducers({
  userinfo
})

export default rootReducer
```

reducersæ–‡ä»¶å¤¹ä¸‹index.jså°±æ˜¯ä¸ºäº†ç»Ÿä¸€ç®¡ç†å„ä¸ªæ¨¡å—çš„æ•°æ®ï¼Œå½“æœ‰å¤šä¸ªjsæ—¶å°±å¯ä»¥æŠŠä»–ä»¬å…¨éƒ¨æ³¨å†Œè¿›combineReducersç„¶åç»Ÿä¸€è¾“å‡ºrootReducerã€‚

### 2. ç”Ÿæˆ store

åœ¨æ ¹ç›®å½•æ–°å»º store/configureStore.js

```js
import { createStore } from 'redux'
import rootReducer from '../reducers'  //å¼•å…¥ç¬¬ä¸€æ­¥ç”Ÿæˆçš„è§„åˆ™

export default function configureStore (initialState) {
  const store = createStore(rootReducer, initialState,
    // è§¦å‘ redux-devtools
    window.devToolsExtension ? window.devToolsExtension() : undefined
  )
  return store
}
```

### 3. å¼•å…¥ storeï¼Œç›‘å¬å˜åŒ–

```js
// é¡¹ç›®å…¥å£ index.js
import React from 'react'
import { render } from 'react-dom'
import { Provider } from 'react-redux'
import configureStore from './store/configureStore'

import Hello from './containers/Hello'

const store = configureStore()

render(
  <Provider store={store}>
    <Hello />
  </Provider>,
  document.getElementById('root')
)
```

### 4. ç»„ä»¶ä¸­æŠŠstateå€¼èµ‹äºˆåˆ°propsï¼Œçœ‹hello.jsxçš„ä»£ç 

```js
import React from 'react'
import { connect } from 'react-redux'
import { bindActionCreators } from 'redux'

import * as userinfoActions from '../actions/userinfo'

import A from '../components/A'
import B from '../components/B'
import C from '../components/C'

class Hello extends React.Component {
  render () {
    return (
      <div>
        <p>hello world</p>
        <hr />
        <A userinfo={this.props.userinfo} />
        <hr />
        <B userinfo={this.props.userinfo} />
        <hr />
        <C actions={this.props.userinfoActions} />
      </div>
    )
  }
  componentDidMount () {
    // æ¨¡æ‹Ÿç™»é™†
    this.props.userinfoActions.login({
      userid: 'abc',
      city: 'beijing'
    })
  }
}
//æŠŠstateèµ‹äºˆåˆ°props->userinfo
function mapStateToProps (state) {
  return {
    userinfo: state.userinfo
  }
}
//ç¬¬äº”æ­¥ï¼šå®šä¹‰äº‹ä»¶ï¼Œè§¦å‘actionæˆ–è€…æ›´æ”¹stateçš„å€¼ï¼Œç„¶åæŠŠäº‹ä»¶èµ‹äºˆåˆ°props
function mapDispatchToProps (dispatch) {
  return {
    userinfoActions: bindActionCreators(userinfoActions, dispatch)
  }
}
//é€šè¿‡connectå‡½æ•°æŠŠä¸¤ä¸ªæ–¹æ³•è·Ÿç»„ä»¶è”ç³»åˆ°ä¸€èµ·ç„¶åè¾“å‡º
export default connect(
  mapStateToProps,
  mapDispatchToProps
)(Hello)
```

### 5. å¦‚æœæƒ³æ”¹å˜reduceé‡Œè¾¹stateçš„å€¼ï¼Œé‚£ä¹ˆå°±éœ€è¦é€šè¿‡äº‹ä»¶å»dispatch action

è¿™é‡Œå®šä¹‰äº†ä¸€äº›actionäº‹ä»¶ï¼š

```js
// app/actions/userinfo.js
import * as actionTypes from '../constants/userinfo'

export function login (data) {
  return {
    type: actionTypes.USERINFO_LOGIN,
    data
  }
}
export function updateCityName (data) {
  return {
    type: actionTypes.UPDATE_CITYNAME,
    data
  }
}
```

ç„¶ååœ¨ç»„ä»¶ä¸­é€šè¿‡ `import * as userinfoActions from '../actions/userinfo'` è¿›æ¥ï¼Œæ¥ç€é€šè¿‡å‡½æ•°ï¼š

```js
function mapDispatchToProps (dispatch) {
  return {
    userinfoActions: bindActionCreators(userinfoActions, dispatch)
  }
}
```

èµ‹äºˆåˆ° `props userinfoActions` ä¸­ï¼›
æ¥ç€ä½¿ç”¨ï¼š

```js
componentDidMount() {
  // æ¨¡æ‹Ÿç™»é™†
  this.props.userinfoActions.login({
    userid: 'abc',
    city: 'beijing'
  })
}
```

## fetch

```jsx
getMoviesFromApiAsync() {
  return fetch('https://facebook.github.io/react-native/movies.json')
    .then((response) => response.json())
    .then((responseJson) => {
      return responseJson.movies;
    })
    .catch((error) => {
      console.error(error);
    });
}
```

ES7 çš„è¯­æ³•ï¼š

```jsx
// æ³¨æ„è¿™ä¸ªæ–¹æ³•å‰é¢æœ‰asyncå…³é”®å­—
async getMoviesFromApi() {
  try {
    // æ³¨æ„è¿™é‡Œçš„awaitè¯­å¥ï¼Œå…¶æ‰€åœ¨çš„å‡½æ•°å¿…é¡»æœ‰asyncå…³é”®å­—å£°æ˜
    let response = await fetch('https://facebook.github.io/react-native/movies.json');
    let responseJson = await response.json();
    return responseJson.movies;
  } catch(error) {
    console.error(error);
  }
}
```